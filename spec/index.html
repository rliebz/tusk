<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>The Spec - tusk</title>

    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">


    <link href="../pygments.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="..">tusk</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Getting Started</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">The Spec</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="..">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li class="disabled">
                        <a rel="prev" >
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/rliebz/tusk"><i class="fa fa-github"></i> GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#the-spec">The Spec</a></li>
            <li class="second-level"><a href="#tasks">Tasks</a></li>
                
            <li class="second-level"><a href="#run">Run</a></li>
                
                <li class="third-level"><a href="#command">Command</a></li>
                <li class="third-level"><a href="#set-environment">Set Environment</a></li>
                <li class="third-level"><a href="#sub-tasks">Sub-Tasks</a></li>
            <li class="second-level"><a href="#when">When</a></li>
                
            <li class="second-level"><a href="#args">Args</a></li>
                
                <li class="third-level"><a href="#arg-values">Arg Values</a></li>
            <li class="second-level"><a href="#options">Options</a></li>
                
                <li class="third-level"><a href="#option-types">Option Types</a></li>
                <li class="third-level"><a href="#option-defaults">Option Defaults</a></li>
                <li class="third-level"><a href="#option-values">Option Values</a></li>
                <li class="third-level"><a href="#required-options">Required Options</a></li>
                <li class="third-level"><a href="#private-options">Private Options</a></li>
                <li class="third-level"><a href="#shared-options">Shared Options</a></li>
            <li class="second-level"><a href="#cli-metadata">CLI Metadata</a></li>
                
            <li class="second-level"><a href="#interpolation">Interpolation</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h2 id="the-spec">The Spec</h2>
<h3 id="tasks">Tasks</h3>
<p>The core of every <code>tusk.yml</code> file is a list of tasks. Tasks are declared at the
top level of the <code>tusk.yml</code> file and include a list of tasks.</p>
<p>For the following tasks:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  hello:
    run: echo &quot;Hello, world!&quot;
  goodbye:
    run: echo &quot;Goodbye, world!&quot;</code></pre>


<p>The commands can be run with no additional configuration:</p>
<pre class="codehilite"><code class="language-text">$ tusk hello
Running: echo &quot;Hello, world!&quot;
Hello, world!</code></pre>


<p>Tasks can be documented with a one-line <code>usage</code> string and a slightly longer
<code>description</code>. This information will be displayed in help messages:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  hello:
    usage: Say hello to the world
    description: |
      This command will echo &quot;Hello, world!&quot; to the user. There's no
      surprises here.
    run: echo &quot;Hello, world!&quot;
  goodbye:
    run: echo &quot;Goodbye, world!&quot;</code></pre>


<h3 id="run">Run</h3>
<p>The behavior of a task is defined in its <code>run</code> clause. A <code>run</code> clause can be
used for commands, sub-tasks, or setting environment variables. Although each
<code>run</code> item can only perform one of these actions, they can be run in succession
to handle complex scenarios.</p>
<h4 id="command">Command</h4>
<p>In its simplest form, <code>run</code> can be given a string or list of strings to be
executed serially as shell commands:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  hello:
    run: echo &quot;Hello!&quot;</code></pre>


<p>This is a shorthand syntax for the following:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  hello:
    run:
      - command: echo &quot;Hello!&quot;</code></pre>


<p>If any of the run commands execute with a non-zero exit code, Tusk will
immediately exit with the same exit code without executing any other commands.</p>
<p>For executing shell commands, the interpreter used will be the value of the
<code>SHELL</code> environment variable. If no environment variable is set, the default is
<code>sh</code>.</p>
<h4 id="set-environment">Set Environment</h4>
<p>The second type of action a <code>run</code> clause can perform is setting or unsetting
environment variables. To do so, simply define a map of environment variable
names to their desired values:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  hello:
    options:
      proxy-url:
        default: http://proxy.example.com
    run:
      - set-environment:
          http_proxy: ${proxy-url}
          https_proxy: ${proxy-url}
          no_proxy: ~
      - command: curl http://example.com</code></pre>


<p>Passing <code>~</code> or <code>null</code> to an environment variable will explicitly unset it, while
passing an empty string will set it to an empty string.</p>
<h4 id="sub-tasks">Sub-Tasks</h4>
<p>Run can also execute previously-defined tasks:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  one:
    run: echo &quot;Inside one&quot;
  two:
    run:
      - task: one
      - command: echo &quot;Inside two&quot;</code></pre>


<p>For any arg or option that a sub-task defines, the parent task can pass a
value, which is treated the same way as passing by command-line would be. Args
are passed in as a list, while options are a map from flag name to value.</p>
<p>To pass values, use the long definition of a sub-task:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  greet:
    args:
      name:
        usage: The person to greet
    options:
      greeting:
        default: Hello
    run: echo &quot;${greeting}, ${person}!&quot;
  greet-myself:
    run:
      task:
        name: greet
        args:
          - me
        options:
          greeting: Howdy</code></pre>


<p>In cases where a sub-task may not be useful on its own, define it as private to
prevent it from being invoked directly from the command-line. For example:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  configure-environment:
    private: true
    run:
      set-environment: {APP_ENV: dev}
  serve:
    run:
      - task: configure-environment
      - command: python main.py</code></pre>


<h3 id="when">When</h3>
<p>For conditional execution, <code>when</code> clauses are available.</p>
<pre class="codehilite"><code class="language-yaml">run:
  when:
    os: linux
  command: echo &quot;This is a linux machine&quot;</code></pre>


<p>In a <code>run</code> clause, any item with a true <code>when</code> clause will execute. There are
five different checks supported:</p>
<ul>
<li><code>command</code> (string): Execute if the command runs with an exit code of <code>0</code>.</li>
<li><code>exists</code> (string): Execute if the file exists.</li>
<li><code>os</code> (list): Execute if the operating system matches any one from the list.</li>
<li><code>environment</code> (map[string -&gt; string]): Execute if the environment variable
  matches the value it maps to. To check if a variable is not set, the value
  should be <code>~</code> or <code>null</code>.</li>
<li><code>equal</code> (map[string -&gt; string]): Execute if the given option equals the value
  it maps to.</li>
<li><code>not-equal</code> (map[string -&gt; string]): Execute if the given option does not
  equal the value it maps to.</li>
</ul>
<p>The <code>when</code> clause supports any number of different checks as a list, where each
check must pass individually for the clause to evaluate to true. Here is a more
complicated example of how <code>when</code> can be used:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  echo:
    options:
      cat:
        usage: Cat a file
    run:
      - when:
          os:
            - linux
            - darwin
        command: echo &quot;This is a unix machine&quot;
      - when:
          - exists: my_file.txt
          - equal: {cat: true}
          - command: command -v cat
        command: cat my_file.txt</code></pre>


<h3 id="args">Args</h3>
<p>Tasks may have args that are passed directly as inputs. Any arg that is defined
is required for the task to execute.</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  greet:
    args:
      name:
        usage: The person to greet
    run: echo &quot;Hello, ${name}!&quot;</code></pre>


<p>The task can be invoked as such:</p>
<pre class="codehilite"><code class="language-text">$ tusk greet friend
Hello, friend!</code></pre>


<h4 id="arg-values">Arg Values</h4>
<p>Args can specify which values are considered valid:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  greet:
    args:
      name:
        values:
          - Abby
          - Bobby
          - Carl</code></pre>


<p>Any value passed by command-line must be one of the listed values, or the
command will fail to execute.</p>
<h3 id="options">Options</h3>
<p>Tasks may have options that are passed as GNU-style flags. The following
configuration will provide <code>-n, --name</code> flags to the CLI and help documentation,
which will then be interpolated:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  greet:
    options:
      name:
        usage: The person to greet
        short: n
        environment: GREET_NAME
        default: World
    run: echo &quot;Hello, ${name}!&quot;</code></pre>


<p>The above configuration will evaluate the value of <code>name</code> in order of highest
priority:</p>
<ol>
<li>The value passed by command line flags (<code>-n</code> or <code>--name</code>)</li>
<li>The value of the environment variable (<code>GREET_NAME</code>), if set</li>
<li>The value set in default</li>
</ol>
<h4 id="option-types">Option Types</h4>
<p>Options can be of the types <code>string</code>, <code>integer</code>, <code>float</code>, or <code>boolean</code>, using
the zero-value of that type as the default if not set. Options without types
specified are considered strings.</p>
<p>For boolean values, the flag should be passed by command line without any
arugments. In the following example:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  greet:
    options:
      loud:
        type: bool
    run:
      - when:
          equal: {loud: true}
        command: echo &quot;HELLO!&quot;
      - when:
          equal: {loud: false}
        command: echo &quot;Hello.&quot;</code></pre>


<p>The flag should be passed as such:</p>
<pre class="codehilite"><code class="language-bash">tusk greet --loud</code></pre>


<p>This means that for an option that is true by default, the only way to disable
it is with the following syntax:</p>
<pre class="codehilite"><code class="language-bash">tusk greet --loud=false</code></pre>


<p>Of course, options can always be defined in the reverse manner to avoid this
issue:</p>
<pre class="codehilite"><code class="language-yaml">options:
  no-loud:
    type: bool</code></pre>


<h4 id="option-defaults">Option Defaults</h4>
<p>Much like <code>run</code> clauses accept a shorthand form, passing a string to <code>default</code>
is shorthand. The following options are exactly equivalent:</p>
<pre class="codehilite"><code class="language-yaml">options:
  short:
    default: foo
  long:
    default:
      - value: foo</code></pre>


<p>A <code>default</code> clause can also register the <code>stdout</code> of a command as its value:</p>
<pre class="codehilite"><code class="language-yaml">options:
  os:
    default:
      command: uname -s</code></pre>


<p>A <code>default</code> clause also accepts a list of possible values with a corresponding
<code>when</code> clause. The first <code>when</code> that evaluates to true will be used as the
default value, with an omitted <code>when</code> always considered true.</p>
<p>In this example, linux users will have the name <code>Linux User</code>, while the default
for all other OSes is <code>User</code>:</p>
<pre class="codehilite"><code class="language-yaml">options:
  name:
    default:
      - when:
          os: linux
        value: Linux User
      - value: User</code></pre>


<h4 id="option-values">Option Values</h4>
<p>Like args, an option can specify which values are considered valid:</p>
<pre class="codehilite"><code class="language-yaml">options:
  number:
    default: zero
    values:
      - one
      - two
      - three</code></pre>


<p>Any value passed by command-line flags or environment variables must be one of
the listed values. Default values, including commands, are excluded from this
requirement.</p>
<h4 id="required-options">Required Options</h4>
<p>Options may be required if there is no sane default value. For a required flag,
the task will not execute unless the flag is passed:</p>
<pre class="codehilite"><code class="language-yaml">options:
  file:
    required: true</code></pre>


<p>A required option cannot be private or have any default values.</p>
<h4 id="private-options">Private Options</h4>
<p>Sometimes it may be desirable to have a variable that cannot be directly
modified through command-line flags. In this case, use the <code>private</code> option:</p>
<pre class="codehilite"><code class="language-yaml">options:
  user:
    private: true
    default:
      command: whoami</code></pre>


<p>A private option will not accept environment variables or command line flags,
and it will not appear in the help documentation.</p>
<h4 id="shared-options">Shared Options</h4>
<p>Options may also be defined at the root of the config file to be shared between
tasks:</p>
<pre class="codehilite"><code class="language-yaml">options:
  name:
    usage: The person to greet
    default: World

tasks:
  hello:
    run: echo &quot;Hello, ${name}!&quot;
  goodbye:
    run: echo &quot;Goodbye, ${name}!&quot;</code></pre>


<p>Any shared variables referenced by a task will be exposed by command-line when
invoking that task. Shared variables referenced by a sub-task will be evaluated
as needed, but not exposed by command-line.</p>
<p>Tasks that define an argument or option with the same name as a shared task will
overwrite the value of the shared option for the length of that task, not
including sub-tasks.</p>
<h3 id="cli-metadata">CLI Metadata</h3>
<p>It is also possible to create a custom CLI tool for use outside of a project's
directory by using shell aliases:</p>
<pre class="codehilite"><code class="language-bash">alias mycli=&quot;tusk -f /path/to/tusk.yml&quot;</code></pre>


<p>In that case, it may be useful to override the tool name and usage text that
are provided as part of the help documentation:</p>
<pre class="codehilite"><code class="language-yaml">name: mycli
usage: A custom aliased command-line application

tasks:
  ...</code></pre>


<p>The example above will produce the following help documentation:</p>
<pre class="codehilite"><code class="language-text">mycli - A custom aliased command-line application

Usage:
  mycli [global options] &lt;task&gt; [task options]

Tasks:
  ...</code></pre>


<h3 id="interpolation">Interpolation</h3>
<p>The interpolation syntax for a variable <code>foo</code> is <code>${foo}</code>, meaning any instances
of <code>${foo}</code> in the configuration file will be replaced with the value of <code>foo</code>
during execution.</p>
<p>Interpolation is done on a task-by-task basis, meaning args and options defined
in one task will not interpolate to any other tasks. Shared options, on the
other hand, will only be evaluated once per execution.</p>
<p>The execution order is as followed:</p>
<ol>
<li>Shared options are interpolated first, in the order defined by the config
   file. The results of global interpolation are cached and not re-run.</li>
<li>The args for the current task being run are interpolated, in order.</li>
<li>The options for the current task being run are interpolated, in order.</li>
<li>For each call to a sub-task, the process is repeated, ignoring the task-
   specific interpolations for parent tasks, using the cached shared options.</li>
</ol>
<p>This means that options can reference other options or args:</p>
<pre class="codehilite"><code class="language-yaml">options:
  name:
    default: World
  greeting:
    default: Hello, ${name}

tasks:
  greet:
    run: echo &quot;${greeting}&quot;</code></pre>


<p>Because interpolation is not always desirable, as in the case of environment
variables, <code>$$</code> will escape to <code>$</code> and ignore interpolation. It is also
possible to use alternative syntax such as <code>$foo</code> to avoid interpolation as
well. The following two tasks will both use environment variables and not
attempt interpolation:</p>
<pre class="codehilite"><code class="language-yaml">tasks:
  one:
    run: Hello, $${USER}
  two:
    run: Hello, $USER</code></pre>


<p>Interpolation works by substituting the value in the <code>yaml</code> config file, then
parsing the file after interpolation. This means that variable values with
newlines or other characters that are relevant to the <code>yaml</code> spec or the <code>sh</code>
interpreter will need to be considered by the user. This can be as simple as
using quotes when appropriate.</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '..';
    </script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
    <script src="../js/base.js"></script>
    <script src="../search/require.js"></script>
    <script src="../search/search.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
